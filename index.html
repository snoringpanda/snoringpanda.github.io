<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purrgress's Completionist Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --bg-card: #12121a;
    --bg-card-hover: #1a1a26;
    --border: #2a2a3a;
    --text: #e4e4ef;
    --text-dim: #8888a0;
    --text-muted: #55556a;
    --accent: #3b82f6;
    --accent-soft: #3b82f633;
    --gold: #f0c040;
    --gold-soft: #f0c04033;
    --green: #22c55e;
    --green-soft: #22c55e22;
    --red: #ef4444;
    --bar-bg: #1e1e2e;
    --bar-fill: linear-gradient(90deg, #3b82f6, #60a5fa);
    --bar-fill-gold: linear-gradient(90deg, #d4a017, #f0c040);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    min-height: 100vh;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--border) 1px, transparent 1px),
      linear-gradient(90deg, var(--border) 1px, transparent 1px);
    background-size: 60px 60px;
    opacity: 0.05;
    pointer-events: none;
  }
  .app { position: relative; z-index: 1; max-width: 900px; margin: 0 auto; padding: 20px 16px 100px; }

  /* HEADER */
  .header { text-align: center; padding: 40px 0 24px; margin-bottom: 24px; }
  .header-title {
    font-family: 'Press Start 2P', monospace;
    font-size: clamp(11px, 3.5vw, 18px);
    color: var(--accent);
    letter-spacing: 2px;
    margin-bottom: 6px;
    text-shadow: 0 0 30px var(--accent-soft);
  }
  .header-sub { font-size: 13px; color: var(--text-dim); font-weight: 300; letter-spacing: 1px; }

  /* SAVE BAR */
  .save-bar {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 18px;
    margin-bottom: 20px;
  }
  .save-bar-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .save-bar-title {
    font-family: 'Press Start 2P', monospace;
    font-size: 8px;
    color: var(--text-muted);
    letter-spacing: 1px;
    margin-bottom: 8px;
  }
  .save-input {
    flex: 1;
    min-width: 200px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 5px;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    padding: 8px 10px;
    word-break: break-all;
  }
  .save-input:focus { outline: none; border-color: var(--accent); }
  .btn {
    padding: 8px 14px;
    border-radius: 5px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .btn:hover { border-color: var(--accent); color: var(--text); }
  .btn-accent { background: var(--accent); border-color: var(--accent); color: white; }
  .btn-accent:hover { opacity: 0.85; }
  .btn-gold { border-color: var(--gold); color: var(--gold); }
  .btn-gold:hover { background: var(--gold-soft); }
  .save-msg {
    font-size: 11px;
    color: var(--green);
    margin-top: 6px;
    min-height: 16px;
    font-family: 'JetBrains Mono', monospace;
  }

  /* GAME SELECT VIEW */
  .game-search {
    width: 100%;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    padding: 10px 14px;
    margin-bottom: 16px;
  }
  .game-search:focus { outline: none; border-color: var(--accent); }
  .game-search::placeholder { color: var(--text-muted); }

  .game-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }
  .game-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .game-card:hover { border-color: var(--accent); background: var(--bg-card-hover); transform: translateY(-2px); }
  .game-card.complete { border-color: var(--gold); }
  .game-card-emoji { font-size: 32px; margin-bottom: 8px; display: block; }
  .game-card-title { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px; line-height: 1.3; }
  .game-card-bar {
    width: 100%;
    height: 4px;
    background: var(--bar-bg);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 4px;
  }
  .game-card-bar-fill {
    height: 100%;
    background: var(--bar-fill);
    border-radius: 2px;
    transition: width 0.3s;
  }
  .game-card-bar-fill.complete { background: var(--bar-fill-gold); }
  .game-card-percent {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
  }
  .game-card-percent.complete { color: var(--gold); }
  .game-count {
    text-align: center;
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 20px;
  }

  /* BACK BUTTON */
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--bg-card);
    color: var(--text-dim);
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
  }
  .back-btn:hover { border-color: var(--accent); color: var(--text); }

  /* DASHBOARD */
  .dashboard {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .dashboard.complete { border-color: var(--gold); box-shadow: 0 0 20px #f0c04022, 0 0 40px #f0c04011; }
  .dash-header { display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 14px; flex-wrap: wrap; gap: 8px; }
  .dash-title { font-size: 22px; font-weight: 700; }
  .dash-pct { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; color: var(--accent); }
  .dash-pct.complete { color: var(--gold); text-shadow: 0 0 20px var(--gold-soft); }
  .overall-bar { width: 100%; height: 16px; background: var(--bar-bg); border-radius: 8px; overflow: hidden; margin-bottom: 14px; }
  .overall-bar-fill { height: 100%; background: var(--bar-fill); border-radius: 8px; transition: width 0.5s cubic-bezier(.25,.8,.25,1); position: relative; }
  .overall-bar-fill.complete { background: var(--bar-fill-gold); }
  .overall-bar-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
    animation: shimmer 2.5s infinite;
  }
  @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

  .cat-stats { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
  .cat-stat { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; }
  .cat-stat.complete { border-color: var(--gold); }
  .cat-stat-name { font-size: 11px; font-weight: 600; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; }
  .cat-stat-count { font-family: 'JetBrains Mono', monospace; font-size: 13px; margin-bottom: 5px; }
  .cat-stat-count .hi { color: var(--accent); }
  .cat-stat-count .gold { color: var(--gold); }
  .cat-bar { width: 100%; height: 5px; background: var(--bar-bg); border-radius: 3px; overflow: hidden; }
  .cat-bar-fill { height: 100%; background: var(--bar-fill); border-radius: 3px; transition: width 0.4s; }
  .cat-bar-fill.complete { background: var(--bar-fill-gold); }

  .celebration { display: none; text-align: center; padding: 20px 0 4px; animation: fadeUp .5s; }
  .celebration.show { display: block; }
  .celeb-text { font-family: 'Press Start 2P', monospace; font-size: clamp(10px, 3vw, 16px); color: var(--gold); text-shadow: 0 0 30px var(--gold-soft); margin-bottom: 6px; }
  .celeb-sub { font-size: 13px; color: var(--text-dim); font-weight: 300; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* META */
  .meta-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
  .meta-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
  .meta-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 5px; }
  .meta-value { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 700; }
  .meta-value.diff { color: var(--gold); }

  /* MISSABLES */
  .missables {
    background: linear-gradient(135deg, #1a0a0a, #12121a);
    border: 1px solid #3a1515;
    border-left: 3px solid var(--red);
    border-radius: 10px;
    padding: 14px 18px;
    margin-bottom: 20px;
  }
  .miss-title { font-family: 'Press Start 2P', monospace; font-size: 8px; color: var(--red); letter-spacing: 1px; margin-bottom: 8px; }
  .miss-list { list-style: none; }
  .miss-list li { font-size: 13px; color: #e88; padding-left: 16px; position: relative; line-height: 1.5; margin-bottom: 4px; }
  .miss-list li::before { content: '‚ö†Ô∏è'; position: absolute; left: 0; font-size: 11px; }

  /* ORDER */
  .order { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 14px 18px; margin-bottom: 20px; }
  .order-title { font-family: 'Press Start 2P', monospace; font-size: 8px; color: var(--accent); letter-spacing: 1px; margin-bottom: 10px; }
  .order-steps { display: flex; flex-direction: column; gap: 7px; }
  .order-step { display: flex; align-items: flex-start; gap: 10px; font-size: 13px; color: var(--text-dim); line-height: 1.5; }
  .order-num {
    flex-shrink: 0; width: 22px; height: 22px; border-radius: 50%;
    background: var(--accent-soft); color: var(--accent);
    font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700;
    display: flex; align-items: center; justify-content: center;
  }

  /* CATEGORIES */
  .category { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 12px; overflow: hidden; }
  .cat-header { padding: 12px 18px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; user-select: none; transition: background .15s; }
  .cat-header:hover { background: var(--bg-card-hover); }
  .cat-header-left { display: flex; align-items: center; gap: 10px; }
  .cat-toggle { font-size: 11px; color: var(--text-muted); transition: transform .3s; }
  .cat-toggle.open { transform: rotate(90deg); }
  .cat-name { font-weight: 600; font-size: 14px; }
  .cat-count { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-dim); }
  .cat-count .hi { color: var(--accent); }

  .cat-items { border-top: 1px solid var(--border); max-height: 0; overflow: hidden; transition: max-height .4s cubic-bezier(.25,.8,.25,1); }
  .cat-items.open { max-height: 10000px; }

  .item { display: flex; align-items: flex-start; gap: 10px; padding: 9px 18px; border-bottom: 1px solid var(--border); transition: background .1s; cursor: pointer; }
  .item:last-child { border-bottom: none; }
  .item:hover { background: var(--bg-card-hover); }
  .item.checked { opacity: 0.45; }
  .item.checked .item-name { text-decoration: line-through; }
  .item-cb {
    flex-shrink: 0; width: 20px; height: 20px; border: 2px solid var(--border);
    border-radius: 4px; display: flex; align-items: center; justify-content: center;
    margin-top: 1px; transition: all .2s; color: transparent; font-size: 12px;
  }
  .item.checked .item-cb { background: var(--accent); border-color: var(--accent); color: white; box-shadow: 0 0 8px var(--accent-soft); }
  .item-content { flex: 1; min-width: 0; }
  .item-name { font-size: 13px; font-weight: 500; margin-bottom: 1px; }
  .item-loc { font-size: 12px; color: var(--text-dim); line-height: 1.4; }
  .item-tip { font-size: 11px; color: var(--accent); font-style: italic; margin-top: 2px; }

  /* STORY */
  .story { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 18px; margin-top: 20px; }
  .story-title { font-family: 'Press Start 2P', monospace; font-size: 8px; color: var(--accent); letter-spacing: 1px; margin-bottom: 10px; }
  .story p { font-size: 13px; color: var(--text-dim); line-height: 1.7; font-weight: 300; }

  /* THEME PICKER */
  .theme-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
    padding: 10px 14px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
  }
  .theme-label {
    font-family: 'Press Start 2P', monospace;
    font-size: 8px;
    color: var(--text-muted);
    letter-spacing: 1px;
    margin-right: 6px;
    white-space: nowrap;
  }
  .theme-swatches { display: flex; gap: 6px; flex-wrap: wrap; }
  .theme-swatch {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }
  .theme-swatch:hover { transform: scale(1.15); }
  .theme-swatch.active {
    border-color: white;
    box-shadow: 0 0 10px var(--accent-soft);
  }
  .theme-swatch.active::after {
    content: '‚úì';
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  }

  /* MOBILE */
  @media (max-width: 600px) {
    .app { padding: 12px 10px 80px; }
    .game-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
    .item { padding: 9px 12px; }
  }
</style>
</head>
<body>
<div class="app" id="app"></div>
<script src="games.js"></script>
<script>
// ============ THEMES ============
const THEMES = {
  blue:   { accent: '#3b82f6', accentSoft: '#3b82f633', barFill: 'linear-gradient(90deg, #3b82f6, #60a5fa)', swatch: '#3b82f6' },
  purple: { accent: '#7c3aed', accentSoft: '#7c3aed33', barFill: 'linear-gradient(90deg, #7c3aed, #a855f7)', swatch: '#7c3aed' },
  green:  { accent: '#22c55e', accentSoft: '#22c55e33', barFill: 'linear-gradient(90deg, #16a34a, #22c55e)', swatch: '#22c55e' },
  red:    { accent: '#ef4444', accentSoft: '#ef444433', barFill: 'linear-gradient(90deg, #dc2626, #ef4444)', swatch: '#ef4444' },
  orange: { accent: '#f97316', accentSoft: '#f9731633', barFill: 'linear-gradient(90deg, #ea580c, #f97316)', swatch: '#f97316' },
  pink:   { accent: '#ec4899', accentSoft: '#ec489933', barFill: 'linear-gradient(90deg, #db2777, #ec4899)', swatch: '#ec4899' },
  cyan:   { accent: '#06b6d4', accentSoft: '#06b6d433', barFill: 'linear-gradient(90deg, #0891b2, #06b6d4)', swatch: '#06b6d4' },
};

function applyTheme(name) {
  const t = THEMES[name] || THEMES.blue;
  currentTheme = name;
  const root = document.documentElement;
  root.style.setProperty('--accent', t.accent);
  root.style.setProperty('--accent-soft', t.accentSoft);
  root.style.setProperty('--bar-fill', t.barFill);
}

function setTheme(name) {
  applyTheme(name);
  render();
}

// ============ STATE ============
let state = {};
let currentGame = null;
let currentTheme = 'blue';
let searchQuery = '';
const openCats = new Set();

function initState() {
  const s = {};
  for (const [gid, game] of Object.entries(GAMES)) {
    s[gid] = {};
    game.categories.forEach((cat, ci) => {
      cat.items.forEach((_, ii) => { s[gid][`${ci}-${ii}`] = false; });
    });
  }
  return s;
}

// ============ SAVE CODE ============
function encode(st) {
  const parts = [];
  for (const [gid, game] of Object.entries(GAMES)) {
    const bits = [];
    game.categories.forEach((cat, ci) => {
      cat.items.forEach((_, ii) => { bits.push(st[gid]?.[`${ci}-${ii}`] ? 1 : 0); });
    });
    // Skip games with zero progress
    if (bits.every(b => b === 0)) continue;
    const bytes = [];
    for (let i = 0; i < bits.length; i += 8) {
      let byte = 0;
      for (let b = 0; b < 8 && i + b < bits.length; b++) byte |= (bits[i + b] << b);
      bytes.push(byte);
    }
    parts.push(gid + ':' + btoa(String.fromCharCode(...bytes)));
  }
  if (currentTheme && currentTheme !== 'blue') parts.push('T:' + currentTheme);
  return 'PG1|' + parts.join('|');
}

function decode(code) {
  if (!code.startsWith('PG1|')) return null;
  const st = initState();
  let theme = 'blue';
  const parts = code.slice(4).split('|');
  for (const part of parts) {
    const sep = part.indexOf(':');
    if (sep === -1) continue;
    const gid = part.slice(0, sep);
    const b64 = part.slice(sep + 1);
    // Handle theme token
    if (gid === 'T') { if (THEMES[b64]) theme = b64; continue; }
    if (!GAMES[gid]) continue;
    try {
      const raw = atob(b64);
      const bytes = []; for (let i = 0; i < raw.length; i++) bytes.push(raw.charCodeAt(i));
      let bi = 0;
      GAMES[gid].categories.forEach((cat, ci) => {
        cat.items.forEach((_, ii) => {
          const byI = Math.floor(bi / 8), biP = bi % 8;
          if (byI < bytes.length) st[gid][`${ci}-${ii}`] = !!(bytes[byI] & (1 << biP));
          bi++;
        });
      });
    } catch(e) {}
  }
  st._theme = theme;
  return st;
}

// ============ STATS ============
function gameStats(gid) {
  const game = GAMES[gid];
  let total = 0, done = 0;
  const cats = game.categories.map((cat, ci) => {
    let cT = cat.items.length, cD = 0;
    cat.items.forEach((_, ii) => { if (state[gid]?.[`${ci}-${ii}`]) cD++; });
    total += cT; done += cD;
    return { name: cat.name, total: cT, done: cD };
  });
  return { total, done, cats, pct: total ? Math.round((done / total) * 100) : 0 };
}

// ============ RENDER ============
function render() {
  const app = document.getElementById('app');
  const gameIds = Object.keys(GAMES);
  const totalGames = gameIds.length;
  const completedGames = gameIds.filter(g => gameStats(g).pct === 100).length;

  let html = `
    <div class="header">
      <div class="header-title">PURRGRESS'S COMPLETIONIST TRACKER</div>
      <div class="header-sub">${totalGames} GAME${totalGames !== 1 ? 'S' : ''} \u2022 ${completedGames} COMPLETED</div>
    </div>
    <div class="save-bar">
      <div class="save-bar-title">\u{1F4BE} SAVE CODE</div>
      <div class="save-bar-row">
        <input class="save-input" id="saveInput" placeholder="Paste code to load or click Generate to save" />
        <button class="btn btn-accent" onclick="genCode()">Generate</button>
        <button class="btn btn-gold" onclick="loadCode()">Load</button>
      </div>
      <div class="save-msg" id="saveMsg"></div>
    </div>
    <div class="theme-bar">
      <span class="theme-label">üé® THEME</span>
      <div class="theme-swatches">
        ${Object.entries(THEMES).map(([name, t]) =>
          `<div class="theme-swatch ${name === currentTheme ? 'active' : ''}" style="background:${t.swatch}" onclick="setTheme('${name}')" title="${name}"></div>`
        ).join('')}
      </div>
    </div>`;

  if (!currentGame) {
    // GAME SELECT VIEW
    html += `<input class="game-search" type="text" placeholder="Search games..." value="${searchQuery}" oninput="searchQuery=this.value;render();" />`;

    const filtered = gameIds.filter(gid =>
      GAMES[gid].title.toLowerCase().includes(searchQuery.toLowerCase())
    );

    html += `<div class="game-count">${filtered.length} of ${totalGames} games shown</div>`;
    html += `<div class="game-grid">`;

    for (const gid of filtered) {
      const g = GAMES[gid];
      const s = gameStats(gid);
      const isFull = s.pct === 100;
      html += `
        <div class="game-card ${isFull ? 'complete' : ''}" onclick="openGame('${gid}')">
          <span class="game-card-emoji">${g.cover || 'üéÆ'}</span>
          <div class="game-card-title">${g.title}</div>
          <div class="game-card-bar"><div class="game-card-bar-fill ${isFull ? 'complete' : ''}" style="width:${s.pct}%"></div></div>
          <div class="game-card-percent ${isFull ? 'complete' : ''}">${s.pct}%</div>
        </div>`;
    }
    html += `</div>`;

  } else {
    // GAME TRACKER VIEW
    const game = GAMES[currentGame];
    const s = gameStats(currentGame);
    const isFull = s.pct === 100;

    html += `<button class="back-btn" onclick="closeGame()">\u2190 All Games</button>`;

    html += `
      <div class="dashboard ${isFull ? 'complete' : ''}">
        <div class="dash-header">
          <div class="dash-title">${game.cover || 'üéÆ'} ${game.title}</div>
          <div class="dash-pct ${isFull ? 'complete' : ''}">${s.pct}%</div>
        </div>
        <div class="overall-bar"><div class="overall-bar-fill ${isFull ? 'complete' : ''}" style="width:${s.pct}%"></div></div>
        <div class="cat-stats">
          ${s.cats.map(c => {
            const cp = c.total ? Math.round((c.done / c.total) * 100) : 0;
            const f = c.done === c.total;
            return `<div class="cat-stat ${f ? 'complete' : ''}">
              <div class="cat-stat-name">${c.name}</div>
              <div class="cat-stat-count">${f ? '<span class="gold">' : '<span class="hi">'}${c.done}</span> / ${c.total}</div>
              <div class="cat-bar"><div class="cat-bar-fill ${f ? 'complete' : ''}" style="width:${cp}%"></div></div>
            </div>`;
          }).join('')}
        </div>
        <div class="celebration ${isFull ? 'show' : ''}">
          <div class="celeb-text">\u{1F451} 100% COMPLETE \u{1F451}</div>
          <div class="celeb-sub">You finished what you started. That changes who you are.</div>
        </div>
      </div>`;

    html += `
      <div class="meta-grid">
        <div class="meta-card"><div class="meta-label">Est. Time</div><div class="meta-value">${game.timeEstimate}</div></div>
        <div class="meta-card"><div class="meta-label">Difficulty</div><div class="meta-value diff">${game.difficulty}</div></div>
        <div class="meta-card"><div class="meta-label">Hardest Part</div><div class="meta-value" style="font-size:11px;color:var(--text-dim)">${game.hardestPart}</div></div>
        <div class="meta-card"><div class="meta-label">Game Version</div><div class="meta-value" style="font-size:14px;color:var(--accent)">${game.gameVersion || '‚Äî'}</div></div>
        <div class="meta-card"><div class="meta-label">Last Updated</div><div class="meta-value" style="font-size:11px;color:var(--text-dim)">${game.lastUpdated || '‚Äî'}</div></div>
      </div>`;

    if (game.missables && game.missables.length) {
      html += `
        <div class="missables">
          <div class="miss-title">\u26A0 MISSABLES ‚Äî READ BEFORE PLAYING</div>
          <ul class="miss-list">${game.missables.map(m => `<li>${m}</li>`).join('')}</ul>
        </div>`;
    }

    if (game.completionOrder && game.completionOrder.length) {
      html += `
        <div class="order">
          <div class="order-title">\u{1F9ED} OPTIMAL COMPLETION ORDER</div>
          <div class="order-steps">
            ${game.completionOrder.map((s, i) => `<div class="order-step"><div class="order-num">${i + 1}</div><div>${s}</div></div>`).join('')}
          </div>
        </div>`;
    }

    game.categories.forEach((cat, ci) => {
      const catDone = cat.items.filter((_, ii) => state[currentGame]?.[`${ci}-${ii}`]).length;
      const isOpen = openCats.has(ci);
      html += `
        <div class="category">
          <div class="cat-header" onclick="toggleCat(${ci})">
            <div class="cat-header-left">
              <div class="cat-toggle ${isOpen ? 'open' : ''}" id="ct-${ci}">\u25B6</div>
              <div class="cat-name">${cat.name}</div>
            </div>
            <div class="cat-count"><span class="hi">${catDone}</span> / ${cat.items.length}</div>
          </div>
          <div class="cat-items ${isOpen ? 'open' : ''}" id="ci-${ci}">
            ${cat.items.map((item, ii) => {
              const chk = state[currentGame]?.[`${ci}-${ii}`];
              return `
              <div class="item ${chk ? 'checked' : ''}" onclick="toggle(${ci},${ii})">
                <div class="item-cb">${chk ? '\u2714' : ''}</div>
                <div class="item-content">
                  <div class="item-name">${item.name}</div>
                  <div class="item-loc">${item.location}</div>
                  ${item.tip ? `<div class="item-tip">\u{1F4A1} ${item.tip}</div>` : ''}
                </div>
              </div>`;
            }).join('')}
          </div>
        </div>`;
    });

    if (game.story) {
      html += `
        <div class="story">
          <div class="story-title">üò∏PURRGRESS'S COMPLETION STORY</div>
          <p>${game.story}</p>
        </div>`;
    }
  }

  app.innerHTML = html;

  // Restore search bar focus after re-render
  if (!currentGame) {
    const search = app.querySelector('.game-search');
    if (search && searchQuery !== '') {
      search.focus();
      search.setSelectionRange(search.value.length, search.value.length);
    }
  }
}

// ============ INTERACTIONS ============
function openGame(gid) { currentGame = gid; openCats.clear(); render(); window.scrollTo(0, 0); }
function closeGame() { currentGame = null; render(); window.scrollTo(0, 0); }

function toggleCat(ci) {
  if (openCats.has(ci)) openCats.delete(ci);
  else openCats.add(ci);
  const items = document.getElementById(`ci-${ci}`);
  const toggle = document.getElementById(`ct-${ci}`);
  if (items) items.classList.toggle('open');
  if (toggle) toggle.classList.toggle('open');
}

function toggle(ci, ii) {
  state[currentGame][`${ci}-${ii}`] = !state[currentGame][`${ci}-${ii}`];
  render();
}

function genCode() {
  const code = encode(state);
  document.getElementById('saveInput').value = code;
  showMsg('\u2714 Code generated! Copy it somewhere safe.', 'var(--green)');
}

function loadCode() {
  const code = document.getElementById('saveInput').value.trim();
  if (!code) { showMsg('\u2718 Paste a save code first.', 'var(--red)'); return; }
  const loaded = decode(code);
  if (!loaded) { showMsg('\u2718 Invalid save code.', 'var(--red)'); return; }
  const theme = loaded._theme || 'blue';
  delete loaded._theme;
  state = loaded;
  applyTheme(theme);
  showMsg('\u2714 Progress loaded!', 'var(--green)');
  render();
}

function showMsg(text, color) {
  const el = document.getElementById('saveMsg');
  if (el) { el.textContent = text; el.style.color = color; setTimeout(() => { el.textContent = ''; }, 4000); }
}

// ============ INIT ============
state = initState();
render();
</script>
</body>
</html>
